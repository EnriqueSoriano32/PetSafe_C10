import{r as f,j as a,a as D,y as M,Y as z}from"./app-49175470.js";import{z as t,u as E,t as B}from"./zod-c844a60c.js";import{_ as F}from"./index-be8e88db.js";import{M as V}from"./ModalForm-9c80ff7b.js";import{D as A}from"./Dropzone-94b97c74.js";import{T as k}from"./TextArea-7cc350fd.js";import{f as G}from"./formatoChat-ba6bae56.js";import{C as O}from"./Carousel-75ad2122.js";import{O as T}from"./OrgLayout-f79dcc5c.js";import"./transition-db21e553.js";import"./dialog-6652f9e5.js";import"./Dropdown-bc2a0d01.js";import"./ResponsiveNavLink-a20d7cf6.js";const L=t.object({imagenes:t.array(t.instanceof(File)).min(1,{message:"Debes subir al menos 1 imagen"}).max(5,{message:"No puedes subir más de 5 imágenes"}).refine(e=>e.every(s=>s.size<=5*1024*1024),{message:"Cada archivo debe ser menor a 5 MB"}).refine(e=>e.every(s=>["image/jpeg","image/png","image/gif"].includes(s.type)),{message:"Solo se permiten archivos JPEG, PNG o GIF"}),deletedImages:t.array(t.number().int().positive()).optional(),contenido:t.string().min(10,{message:"Ecribe al menos 10 caracteres"}).max(280,{message:"No puedes escribir más de  280 caracteres"})}),_=({open:e,onClose:s,post:r})=>{const{setValue:o,register:j,handleSubmit:P,watch:x,reset:l,getValues:v,formState:{errors:I,isSubmitting:b}}=E({mode:"onChange",resolver:B(L)}),d=x("imagenes"),[h,w]=f.useState([]);f.useEffect(()=>{r&&(o("contenido",r==null?void 0:r.contenido),o("deletedImages",[]),w(r==null?void 0:r.imagenes))},[r]);const S=f.useMemo(()=>[...h||[],...d||[]],[d,r,h]),c=n=>{const i=new FormData;for(const g in n)if(n.hasOwnProperty(g)){const y=n[g];if(y instanceof Array)for(let N=0;N<y.length;N++)i.append(g+"[]",y[N]);else i.append(g,y)}D.post("/org/post/update",i).then(()=>{F.success("Publicación creada"),l(),s(),M.reload()}).catch(()=>{F.error("Ocurrió un error")})},m=()=>{l(),w([]),s()},u=()=>{P(c)()},p=n=>{if([...d||[]].some(i=>i.name==n)){const i=[...d].filter(g=>g.name!==n);o("imagenes",i,{shouldValidate:!0})}[...h||[]].some(i=>i.id==n)&&Swal.fire({title:"Eliminar imagen",text:"¿Quieres eliminar esta imagen?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar!",cancelButtonText:"Cancelar"}).then(i=>{if(i.isConfirmed){const g=[...h].filter(N=>N.id!==n);w(g);const y=v("deletedImages");o("deletedImages",[...y,n])}})},C=f.useCallback(n=>{const i=[...d||[],...n];o("imagenes",i,{shouldValidate:!0})},[d]);return a.jsx(V,{title:"Crear publicación",show:e,onClose:s,closeable:!1,primaryAction:u,secondaryAction:m,primaryLabel:"Publicar",secondaryLabel:"Cancelar",children:a.jsxs("form",{className:"space-y-6 px-5 py-2",children:[a.jsx(k,{id:"descripcion",label:"Descripción",required:!0,type:"text",errors:I.descripcion,disabled:b,register:j}),a.jsx(A,{uploadImages:C,removeImage:p,images:S,errors:I.imagenes,isDisabled:b,inputText:"Presiona o arrastra imagenes de tu mascota (máximo 5 imágenes)"})]})})},q=t.object({imagenes:t.array(t.instanceof(File)).min(1,{message:"Debes subir al menos 1 imagen"}).max(5,{message:"No puedes subir más de 5 imágenes"}).refine(e=>e.every(s=>s.size<=5*1024*1024),{message:"Cada archivo debe ser menor a 5 MB"}).refine(e=>e.every(s=>["image/jpeg","image/png","image/gif"].includes(s.type)),{message:"Solo se permiten archivos JPEG, PNG o GIF"}),contenido:t.string().min(10,{message:"Ecribe al menos 10 caracteres"}).max(280,{message:"No puedes escribir más de  280 caracteres"})}),J=({open:e,onClose:s})=>{const{setValue:r,register:o,handleSubmit:j,watch:P,reset:x,formState:{errors:l,isSubmitting:v}}=E({mode:"onChange",resolver:B(q),defaultValues:{imagenes:[]}}),I=c=>{const m=new FormData;for(const u in c)if(c.hasOwnProperty(u)){const p=c[u];if(p instanceof Array)for(let C=0;C<p.length;C++)m.append(u+"[]",p[C]);else m.append(u,p)}D.post("/org/post",m).then(()=>{F.success("Publicación creada"),x(),s(),M.reload()}).catch(()=>{F.error("Ocurrió un error")})},b=P("imagenes"),d=()=>{x(),s()},h=()=>{j(I)()},w=c=>{const m=[...b].filter(u=>u.name!==c);r("imagenes",m,{shouldValidate:!0})},S=f.useCallback(c=>{const m=[...b,...c];r("imagenes",m,{shouldValidate:!0})},[b]);return a.jsx(V,{title:"Crear publicación",show:e,onClose:s,closeable:!1,primaryAction:h,secondaryAction:d,primaryLabel:"Publicar",secondaryLabel:"Cancelar",disabledButtons:v,children:a.jsxs("form",{className:"space-y-6 px-5 py-2",children:[a.jsx(k,{id:"contenido",label:"Contenido",required:!0,type:"text",errors:l.contenido,disabled:v,register:o}),a.jsx(A,{uploadImages:S,removeImage:w,images:b,errors:l.imagenes,isDisabled:v,inputText:"Presiona o arrastra imagenes de tu mascota (máximo 5 imágenes)"})]})})},R=({post:e})=>{var s;return console.log(e),a.jsxs("div",{className:"px-2 border-b-2",children:[a.jsxs("header",{className:"flex items-center gap-2",children:[a.jsx("img",{src:e!=null&&e.photo?e==null?void 0:e.photo:"/imagenes/blank_profile.png",alt:"profile image",className:"rounded-full w-14 h-14"}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("p",{className:"font-bold",children:(s=e==null?void 0:e.org)==null?void 0:s.nombre_organizacion}),a.jsx("p",{className:"text-gray-400 text-xs",children:G(e==null?void 0:e.created_at)})]})]}),a.jsx("div",{className:"mt-2 font-bold",children:e==null?void 0:e.contenido}),a.jsx(O,{images:e==null?void 0:e.imagenes,type:"show"})]})},Q=({posts:e})=>{const[s,r]=f.useState(!1),[o,j]=f.useState(!1),[P,x]=f.useState(null);return a.jsxs(a.Fragment,{children:[a.jsx(z,{title:"Inicio"}),a.jsx(J,{open:s,onClose:()=>r(!1)}),a.jsx(_,{open:o,onClose:()=>{j(!1),x(null)},post:P}),a.jsx("div",{className:"py-12",children:a.jsx("button",{className:"",onClick:()=>r(!0),children:"Realizar publicación"})}),a.jsx("div",{className:"max-w-[1056px] mx-auto pt-6 bg-white border-t-2",children:e.map(l=>a.jsx(R,{post:l},l.id))})]})};Q.layout=e=>a.jsx(T,{children:e,header:a.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Posts"})});export{Q as default};
